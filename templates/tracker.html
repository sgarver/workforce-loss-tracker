
<!-- Page Header -->
<div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Workforce Loss Tracker</h1>
    <p class="mt-2 text-gray-600 dark:text-gray-400">Browse and filter workforce losses by industry</p>
</div>

    <!-- Filters -->
    <details class="card-bg p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700 mb-8">
        <summary class="text-lg font-semibold text-gray-900 dark:text-white mb-4 cursor-pointer">üîç Filters</summary>
        <form id="filter-form" method="GET" class="space-y-4">
             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                 <!-- Search -->
                 <div>
                     <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Search Company</label>
                     <input type="text" name="search" value="{{.Filters.Search}}" placeholder="Search..."
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                 </div>

                  <!-- Industry -->
                  <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Industry</label>
                       <select name="industry" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"><!-- test -->
                          <option value="">All Industries</option>
                          {{range .Industries}}
                          <option value="{{.}}" {{if eq . $.Filters.Industry}}selected{{end}}>{{.}}</option>
                          {{end}}
                      </select>
                  </div>

                 <!-- Min Employees -->
                 <div>
                     <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Min Employees</label>
                     <input type="number" name="min_employees" value="{{.Filters.MinEmployees}}" placeholder="0" min="0"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                 </div>

                 <!-- Max Employees -->
                 <div>
                     <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Employees</label>
                     <input type="number" name="max_employees" value="{{.Filters.MaxEmployees}}" placeholder="10000" min="0"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                 </div>
             </div>

             <!-- Date Range Filters -->
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                 <!-- Start Date -->
                 <div>
                     <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Start Date</label>
                     <input type="date" name="start_date" value="{{.Filters.StartDate}}"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                 </div>

                  <!-- End Date -->
                  <div>
                      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">End Date</label>
                      <input type="date" name="end_date" value="{{.Filters.EndDate}}"
                             class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                  </div>
              </div>

              <!-- Date Unknown Filter -->
              <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                  <div class="flex items-center">
                      <input type="checkbox" id="include_unknown_dates" name="include_unknown_dates" value="true" {{if .Filters.IncludeUnknownDates}}checked{{end}}
                             class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                      <label for="include_unknown_dates" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">
                          Include layoffs with unknown dates
                      </label>
                  </div>
              </div>

            <!-- Action Buttons -->
            <div class="flex items-center space-x-4">
                <button type="submit" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                    Apply Filters
                </button>
                <a href="/tracker" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-md text-sm font-medium">
                    Clear
                </a>
                <a href="/export/csv" class="text-primary-600 dark:text-primary-400 hover:underline text-sm">
                    Export CSV
                </a>
            </div>
        </form>
    </details>

    <!-- Results -->
    <div class="card-bg rounded-lg shadow border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                üìä Layoffs ({{.Pagination.Total}} found)
            </h2>
            <div class="text-sm text-gray-500 dark:text-gray-400">
                Page {{.Pagination.Page}} of {{.Pagination.TotalPages}}
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="table-bg">
                    <tr>
                        <th class="w-1/6 px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                            <a href="?{{if .Filters.Search}}search={{.Filters.Search}}&{{end}}{{if .Filters.Industry}}industry={{.Filters.Industry}}&{{end}}{{if .Filters.MinEmployees}}min_employees={{.Filters.MinEmployees}}&{{end}}{{if .Filters.MaxEmployees}}max_employees={{.Filters.MaxEmployees}}&{{end}}{{if .Filters.StartDate}}start_date={{.Filters.StartDate}}&{{end}}{{if .Filters.EndDate}}end_date={{.Filters.EndDate}}&{{end}}sort_by=company&sort_direction={{if and (eq .Filters.SortBy "company") (eq .Filters.SortDirection "asc")}}desc{{else}}asc{{end}}" class="hover:text-gray-700 dark:hover:text-gray-100 flex items-center">
                                Company
                                {{if eq .Filters.SortBy "company"}}
                                    {{if eq .Filters.SortDirection "asc"}} ‚Üë{{else}} ‚Üì{{end}}
                                {{end}}
                            </a>
                        </th>
                        <th class="w-1/6 px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                            <a href="?{{if .Filters.Search}}search={{.Filters.Search}}&{{end}}{{if .Filters.Industry}}industry={{.Filters.Industry}}&{{end}}{{if .Filters.MinEmployees}}min_employees={{.Filters.MinEmployees}}&{{end}}{{if .Filters.MaxEmployees}}max_employees={{.Filters.MaxEmployees}}&{{end}}{{if .Filters.StartDate}}start_date={{.Filters.StartDate}}&{{end}}{{if .Filters.EndDate}}end_date={{.Filters.EndDate}}&{{end}}sort_by=industry&sort_direction={{if and (eq .Filters.SortBy "industry") (eq .Filters.SortDirection "asc")}}desc{{else}}asc{{end}}" class="hover:text-gray-700 dark:hover:text-gray-100 flex items-center">
                                Industry
                                {{if eq .Filters.SortBy "industry"}}
                                    {{if eq .Filters.SortDirection "asc"}} ‚Üë{{else}} ‚Üì{{end}}
                                {{end}}
                            </a>
                        </th>
                        <th class="w-1/6 px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                            <a href="?{{if .Filters.Search}}search={{.Filters.Search}}&{{end}}{{if .Filters.Industry}}industry={{.Filters.Industry}}&{{end}}{{if .Filters.MinEmployees}}min_employees={{.Filters.MinEmployees}}&{{end}}{{if .Filters.MaxEmployees}}max_employees={{.Filters.MaxEmployees}}&{{end}}{{if .Filters.StartDate}}start_date={{.Filters.StartDate}}&{{end}}{{if .Filters.EndDate}}end_date={{.Filters.EndDate}}&{{end}}sort_by=company_size&sort_direction={{if and (eq .Filters.SortBy "company_size") (eq .Filters.SortDirection "asc")}}desc{{else}}asc{{end}}" class="hover:text-gray-700 dark:hover:text-gray-100 flex items-center">
                                Company Size
                                {{if eq .Filters.SortBy "company_size"}}
                                    {{if eq .Filters.SortDirection "asc"}} ‚Üë{{else}} ‚Üì{{end}}
                                {{end}}
                            </a>
                        </th>
                        <th class="w-1/6 px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                            <a href="?{{if .Filters.Search}}search={{.Filters.Search}}&{{end}}{{if .Filters.Industry}}industry={{.Filters.Industry}}&{{end}}{{if .Filters.MinEmployees}}min_employees={{.Filters.MinEmployees}}&{{end}}{{if .Filters.MaxEmployees}}max_employees={{.Filters.MaxEmployees}}&{{end}}{{if .Filters.StartDate}}start_date={{.Filters.StartDate}}&{{end}}{{if .Filters.EndDate}}end_date={{.Filters.EndDate}}&{{end}}sort_by=employees&sort_direction={{if and (eq .Filters.SortBy "employees") (eq .Filters.SortDirection "asc")}}desc{{else}}asc{{end}}" class="hover:text-gray-700 dark:hover:text-gray-100 flex items-center">
                                Employees
                                {{if eq .Filters.SortBy "employees"}}
                                    {{if eq .Filters.SortDirection "asc"}} ‚Üë{{else}} ‚Üì{{end}}
                                {{end}}
                            </a>
                        </th>
                        <th class="w-1/6 px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                        <th class="w-1/6 px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                            <a href="?{{if .Filters.Search}}search={{.Filters.Search}}&{{end}}{{if .Filters.Industry}}industry={{.Filters.Industry}}&{{end}}{{if .Filters.MinEmployees}}min_employees={{.Filters.MinEmployees}}&{{end}}{{if .Filters.MaxEmployees}}max_employees={{.Filters.MaxEmployees}}&{{end}}{{if .Filters.StartDate}}start_date={{.Filters.StartDate}}&{{end}}{{if .Filters.EndDate}}end_date={{.Filters.EndDate}}&{{end}}sort_by=date&sort_direction={{if and (eq .Filters.SortBy "date") (eq .Filters.SortDirection "asc")}}desc{{else}}asc{{end}}" class="hover:text-gray-700 dark:hover:text-gray-100 flex items-center">
                                Date
                                {{if eq .Filters.SortBy "date"}}
                                    {{if eq .Filters.SortDirection "asc"}} ‚Üë{{else}} ‚Üì{{end}}
                                {{end}}
                            </a>
                        </th>

                    </tr>
                </thead>
                <tbody class="card-bg divide-y divide-gray-200 dark:divide-gray-700">
                    {{range .Layoffs}}
                    <tr class="hover:table-bg">
                         <td class="px-6 py-4 whitespace-nowrap">
                             <div class="flex items-center">
                                 <div class="flex-shrink-0 h-10 w-10 flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-full">
                                     <span class="text-lg">üè¢</span>
                                 </div>
                                 <div class="ml-4">
                                      <div class="text-sm font-medium text-gray-900 dark:text-white">
                                          <a href="/layoffs/{{.ID}}" class="hover:text-primary-600 dark:hover:text-primary-400">
                                               {{.Company.Name}}
                                          </a>
                                      </div>
                                 </div>
                             </div>
                         </td>
                         <td class="px-6 py-4 whitespace-nowrap">
                             {{if and .Company.Industry (ne .Company.Industry "")}}
                              <a href="/tracker?industry={{.Company.Industry}}" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full {{.IndustryBgClass}} {{.IndustryTextClass}} {{.IndustryHoverClass}} transition-colors">
                                  {{.Company.Industry}}
                              </a>
                             {{else}}
                             <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                                 Unknown
                             </span>
                             {{end}}
                         </td>
                         <td class="px-6 py-4 whitespace-nowrap">
                              <div class="text-sm text-gray-900 dark:text-white font-medium">{{if .Company.EmployeeCount.Valid}}{{.Company.EmployeeCount.Int64}}{{else}}-{{end}}</div>
                         </td>
                         <td class="px-6 py-4 whitespace-nowrap">
                             <div class="text-sm text-gray-900 dark:text-white font-medium">{{.EmployeesAffected}}</div>
                         </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {{if and .Status.Valid (eq .Status.String "planned")}}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200">
                                Planned
                            </span>
                            {{else}}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
                                Completed
                            </span>
                            {{end}}
                        </td>
                         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                             {{if eq .DisplayDate "unknown"}}
                                 <span class="text-gray-400">Unknown</span>
                             {{else}}
                                 {{timeAgo .LayoffDate}}
                             {{end}}
                         </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">

                        </td>
                    </tr>
                    {{else}}
                      <tr>
                          <td colspan="6" class="px-6 py-12 text-center">
                             <div class="text-gray-500 dark:text-gray-400">
                                 <span class="text-2xl mb-2 block">üìä</span>
                                 No workforce losses found matching your criteria.
                             </div>
                         </td>
                     </tr>
                    {{end}}
                </tbody>
             </table>
         </div>

         <!-- Pagination -->
         {{if gt .Pagination.TotalPages 1}}
         <div class="mt-6 flex items-center justify-between">
             <div class="text-sm text-gray-700 dark:text-gray-300">
                 Showing {{len .Layoffs}} of {{.Pagination.Total}} workforce losses
             </div>
             <div class="flex items-center space-x-2">
                 {{if gt .Pagination.Page 1}}
                 <a href="?page={{subtract .Pagination.Page 1}}{{if .Filters.Search}}&search={{.Filters.Search}}{{end}}{{if .Filters.Industry}}&industry={{.Filters.Industry}}{{end}}{{if .Filters.MinEmployees}}&min_employees={{.Filters.MinEmployees}}{{end}}{{if .Filters.MaxEmployees}}&max_employees={{.Filters.MaxEmployees}}{{end}}{{if .Filters.StartDate}}&start_date={{.Filters.StartDate}}{{end}}{{if .Filters.EndDate}}&end_date={{.Filters.EndDate}}{{end}}"
                    class="px-3 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700">
                     ‚Üê Previous
                 </a>
                 {{end}}

                 <span class="px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                     Page {{.Pagination.Page}} of {{.Pagination.TotalPages}}
                 </span>

                 {{if lt .Pagination.Page .Pagination.TotalPages}}
                 <a href="?page={{add .Pagination.Page 1}}{{if .Filters.Search}}&search={{.Filters.Search}}{{end}}{{if .Filters.Industry}}&industry={{.Filters.Industry}}{{end}}{{if .Filters.MinEmployees}}&min_employees={{.Filters.MinEmployees}}{{end}}{{if .Filters.MaxEmployees}}&max_employees={{.Filters.MaxEmployees}}{{end}}{{if .Filters.StartDate}}&start_date={{.Filters.StartDate}}{{end}}{{if .Filters.EndDate}}&end_date={{.Filters.EndDate}}{{end}}"
                    class="px-3 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700">
                     Next ‚Üí
                 </a>
                 {{end}}
             </div>
         </div>
         {{end}}
     </div>